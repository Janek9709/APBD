CREATE PROCEDURE PromoteStudent @STUDIES VARCHAR(255), @SEMESTER INT
AS
BEGIN
	DECLARE @IFEXISTIS INT;
	DECLARE @IDOFSTUDIES INT;

	SELECT @IDOFSTUDIES = IDSTUDY FROM STUDIES WHERE NAME = @STUDIES;
	SELECT @IFEXISTIS = COUNT(IDENROLLMENT) FROM ENROLLMENT WHERE SEMESTER = @SEMESTER+1 AND IDSTUDY = @IDOFSTUDIES

	IF @IFEXISTIS = 0
		BEGIN
			INSERT INTO ENROLLMENT
			VALUES((SELECT MAX(IDENROLLMENT)+1 FROM ENROLLMENT), @SEMESTER+1, @IDOFSTUDIES, Current_TimeStamp)
		END;

	UPDATE STUDENT
	SET IDENROLLMENT = (SELECT IDENROLLMENT FROM ENROLLMENT WHERE SEMESTER = @SEMESTER+1 AND IDSTUDY = @IDOFSTUDIES)
	WHERE IDENROLLMENT = (SELECT IDENROLLMENT FROM ENROLLMENT WHERE SEMESTER = @SEMESTER AND IDSTUDY = @IDOFSTUDIES)

END

EXEC PromoteStudent @STUDIES = 'Zarzadzanie', @SEMESTER = 1

SELECT IDSTUDY, SEMESTER, STARTDATE FROM ENROLLMENT WHERE IDSTUDY = (SELECT IDSTUDY FROM STUDIES WHERE NAME = 'IT') AND SEMESTER = 1 GROUP BY IDSTUDY, SEMESTER, STARTDATE;

SELECT * FROM Enrollment

SELECT IDENROLLMENT FROM ENROLLMENT WHERE IDSTUDY = 3


SELECT * FROM STUDIES

SELECT IDSTUDY FROM ENROLLMENT WHERE IDSTUDY = (SELECT IDSTUDY FROM STUDIES WHERE NAME = 'IT') AND SEMESTER = 1;

SELECT MAX(IDENROLLMENT) AS MAX, STARTDATE FROM ENROLLMENT WHERE SEMESTER = 1 AND IDSTUDY = 3 GROUP BY STARTDATE

SELECT MAX(IDENROLLMENT) AS MAX, STARTDATE FROM ENROLLMENT WHERE SEMESTER = 1 AND IDSTUDY = 3 GROUP BY STARTDATE

SELECT * FROM STUDENT

SELECT IDSTUDY FROM STUDIES WHERE NAME = 'IT'